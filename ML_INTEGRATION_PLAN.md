# ü§ñ –ü–õ–ê–ù –î–û–†–ê–ë–û–¢–ö–ò ML –ê–ù–ê–õ–ò–ó–ê –ò –ò–ù–¢–ï–ì–†–ê–¶–ò–ò

## üéØ –¶–ï–õ–¨: –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å ML –º–æ–¥–µ–ª—å —Å –¥–µ—Ç–µ–∫—Ç–∏–≤–Ω—ã–º –∞–Ω–∞–ª–∏–∑–æ–º

### ‚ùå –¢–ï–ö–£–©–ò–ï –ü–†–û–ë–õ–ï–ú–´:

1. **ML –º–æ–¥–µ–ª—å –æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç –¥–µ—Ç–µ–∫—Ç–∏–≤–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞**
   - `src/ml_models/ml_models.py` - –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–æ–¥—É–ª—å
   - `src/analyzers/proper_ml_detective_analysis.py` - –¥—Ä—É–≥–æ–π –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–æ–¥—É–ª—å
   - `src/analyzers/production_sales_analyzer.py` - –¥–µ—Ç–µ–∫—Ç–∏–≤–Ω—ã–π –±–µ–∑ ML

2. **–ù–µ—Ç SHAP –æ–±—ä—è—Å–Ω–∏–º–æ—Å—Ç–∏ –≤ –ø—Ä–æ–¥–∞–∫—à–Ω–µ**
   - ML –º–æ–¥–µ–ª—å –µ—Å—Ç—å, –Ω–æ –Ω–µ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞
   - SHAP –∞–Ω–∞–ª–∏–∑ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
   - –ù–µ—Ç –æ–±—ä—è—Å–Ω–µ–Ω–∏—è –ø—Ä–∏—á–∏–Ω –ø–∞–¥–µ–Ω–∏–π/—Ä–æ—Å—Ç–∞

3. **–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –µ–¥–∏–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å**
   - –î–µ—Ç–µ–∫—Ç–∏–≤–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –æ—Ç–¥–µ–ª—å–Ω–æ
   - ML –ø—Ä–æ–≥–Ω–æ–∑—ã –æ—Ç–¥–µ–ª—å–Ω–æ
   - –ù–µ—Ç –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞

## ‚úÖ –†–ï–®–ï–ù–ò–ï: 3 –≠–¢–ê–ü–ê –ò–ù–¢–ï–ì–†–ê–¶–ò–ò

### üîß –≠–¢–ê–ü 1: –°–æ–∑–¥–∞—Ç—å –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π ML-–¥–µ—Ç–µ–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å

**–§–∞–π–ª:** `src/analyzers/integrated_ml_detective.py`

```python
class IntegratedMLDetective:
    """–û–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–π ML + –¥–µ—Ç–µ–∫—Ç–∏–≤–Ω—ã–π –∞–Ω–∞–ª–∏–∑"""
    
    def __init__(self):
        # –î–µ—Ç–µ–∫—Ç–∏–≤–Ω—ã–π –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä (—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π)
        self.detective = ProductionSalesAnalyzer()
        
        # ML –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–Ω–æ–≤—ã–µ)
        self.ml_model = RandomForestRegressor(n_estimators=100)
        self.shap_explainer = None
        self.feature_names = []
        
    def analyze_with_ml_explanations(self, restaurant_name, start_date, end_date):
        """–ì–õ–ê–í–ù–´–ô –ú–ï–¢–û–î: –¥–µ—Ç–µ–∫—Ç–∏–≤–Ω—ã–π –∞–Ω–∞–ª–∏–∑ + ML –æ–±—ä—è—Å–Ω–µ–Ω–∏—è"""
        
        # 1. –ü–æ–ª—É—á–∞–µ–º –¥–µ—Ç–µ–∫—Ç–∏–≤–Ω—ã–π –∞–Ω–∞–ª–∏–∑ (—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π)
        detective_results = self.detective.analyze_restaurant_performance(...)
        
        # 2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ–±–ª–µ–º–Ω–æ–≥–æ –¥–Ω—è –¥–æ–±–∞–≤–ª—è–µ–º ML –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ
        ml_enhanced_results = []
        for result in detective_results:
            if "–ü–†–û–ë–õ–ï–ú–ù–´–ô –î–ï–ù–¨" in result:
                # –î–æ–±–∞–≤–ª—è–µ–º ML –∞–Ω–∞–ª–∏–∑ –ø—Ä–∏—á–∏–Ω
                ml_explanation = self._get_ml_explanation_for_day(...)
                result += f"\nüß† ML –û–ë–™–Ø–°–ù–ï–ù–ò–ï:\n{ml_explanation}"
            ml_enhanced_results.append(result)
            
        return ml_enhanced_results
```

### üîß –≠–¢–ê–ü 2: –î–æ–±–∞–≤–∏—Ç—å SHAP –æ–±—ä—è—Å–Ω–∏–º–æ—Å—Ç—å

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**

1. **–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è ML:**
```python
def _prepare_ml_features(self, restaurant_name, target_date):
    """–ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ—Ç –ø—Ä–∏–∑–Ω–∞–∫–∏ –¥–ª—è ML –±–µ–∑ —Ü–∏—Ä–∫—É–ª—è—Ä–Ω–æ–π –ª–æ–≥–∏–∫–∏"""
    
    features = {
        # –í–Ω–µ—à–Ω–∏–µ —Ñ–∞–∫—Ç–æ—Ä—ã (–ù–ï –∑–∞–≤–∏—Å—è—Ç –æ—Ç –ø—Ä–æ–¥–∞–∂)
        'day_of_week': self._get_day_of_week(target_date),
        'is_holiday': self._check_holiday(target_date),
        'weather_temp': self._get_weather(restaurant_name, target_date)['temp'],
        'weather_rain': self._get_weather(restaurant_name, target_date)['rain'],
        
        # –û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ (–ø—Ä–µ–¥—à–µ—Å—Ç–≤—É—é—â–∏–µ –ø—Ä–æ–¥–∞–∂–∞–º)
        'grab_offline_rate': self._get_grab_offline_rate(target_date),
        'gojek_close_time': self._get_gojek_close_time(target_date),
        'preparation_time': self._get_preparation_time(target_date),
        'delivery_time': self._get_delivery_time(target_date),
        
        # –ú–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤—ã–µ (–≤—Ö–æ–¥—è—â–∏–µ)
        'ads_spend': self._get_ads_spend(target_date),
        'ads_impressions': self._get_ads_impressions(target_date),
        
        # –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ (–∑–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –¥–Ω–∏)
        'sales_7day_avg': self._get_sales_avg(target_date, days=7),
        'rating_trend': self._get_rating_trend(target_date, days=7)
    }
    
    return features
```

2. **SHAP –∞–Ω–∞–ª–∏–∑:**
```python
def _get_shap_explanation(self, features, actual_sales, predicted_sales):
    """–ü–æ–ª—É—á–∞–µ—Ç SHAP –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –¥–Ω—è"""
    
    # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ —Ñ–æ—Ä–º–∞—Ç –¥–ª—è SHAP
    feature_array = np.array(list(features.values())).reshape(1, -1)
    
    # –ü–æ–ª—É—á–∞–µ–º SHAP –∑–Ω–∞—á–µ–Ω–∏—è
    shap_values = self.shap_explainer.shap_values(feature_array)[0]
    
    # –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –≤–∞–∂–Ω–æ—Å—Ç–∏
    feature_importance = list(zip(self.feature_names, shap_values))
    feature_importance.sort(key=lambda x: abs(x[1]), reverse=True)
    
    # –§–æ—Ä–º–∏—Ä—É–µ–º –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ
    explanation = []
    for feature_name, shap_value in feature_importance[:5]:  # –¢–û–ü-5
        impact_pct = (shap_value / predicted_sales) * 100
        impact_idr = shap_value
        
        if abs(impact_pct) > 5:  # –¢–æ–ª—å–∫–æ –∑–Ω–∞—á–∏–º—ã–µ
            explanation.append(
                f"‚Ä¢ {self._format_feature_name(feature_name)}: "
                f"{impact_pct:+.1f}% –≤–ª–∏—è–Ω–∏—è ({impact_idr:+,.0f} IDR)"
            )
    
    return explanation
```

### üîß –≠–¢–ê–ü 3: –û–±–Ω–æ–≤–∏—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–π –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä

**–§–∞–π–ª:** `src/analyzers/production_sales_analyzer.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

1. **–î–æ–±–∞–≤–∏—Ç—å ML –∏–º–ø–æ—Ä—Ç:**
```python
from .integrated_ml_detective import IntegratedMLDetective
```

2. **–û–±–Ω–æ–≤–∏—Ç—å –º–µ—Ç–æ–¥ –∞–Ω–∞–ª–∏–∑–∞:**
```python
def analyze_restaurant_performance(self, restaurant_name, start_date, end_date):
    """–û—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥ —Å ML –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π"""
    
    # –ï—Å–ª–∏ ML –¥–æ—Å—Ç—É–ø–µ–Ω - –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑
    if self._ml_available():
        ml_detective = IntegratedMLDetective()
        return ml_detective.analyze_with_ml_explanations(
            restaurant_name, start_date, end_date
        )
    
    # –ò–Ω–∞—á–µ - –æ–±—ã—á–Ω—ã–π –¥–µ—Ç–µ–∫—Ç–∏–≤–Ω—ã–π –∞–Ω–∞–ª–∏–∑
    return self._standard_detective_analysis(restaurant_name, start_date, end_date)
```

## üìä –û–ñ–ò–î–ê–ï–ú–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢

### –î–û (—Ç–µ–∫—É—â–∏–π –¥–µ—Ç–µ–∫—Ç–∏–≤–Ω—ã–π –∞–Ω–∞–ª–∏–∑):
```
üìâ –ü–†–û–ë–õ–ï–ú–ù–´–ô –î–ï–ù–¨ #1: 2025-05-15
   üíî –ü–∞–¥–µ–Ω–∏–µ –ø—Ä–æ–¥–∞–∂: -67.8% (1,250,000 IDR)
   
   üîç –§–ê–ö–¢–û–†–´ –í–õ–ò–Ø–ù–ò–Ø:
      1. üö® –ö–†–ò–¢–ò–ß–ù–û: Grab offline 357% (5—á 57–º –≤—ã–∫–ª—é—á–µ–Ω!)
      2. ‚ö†Ô∏è Gojek Delivery +89% (19.8–º–∏–Ω vs 10.5–º–∏–Ω)
      3. ‚úÖ Gojek ROAS –æ—Ç–ª–∏—á–Ω—ã–π: 25.0
```

### –ü–û–°–õ–ï (–¥–µ—Ç–µ–∫—Ç–∏–≤–Ω—ã–π + ML):
```
üìâ –ü–†–û–ë–õ–ï–ú–ù–´–ô –î–ï–ù–¨ #1: 2025-05-15
   üíî –ü–∞–¥–µ–Ω–∏–µ –ø—Ä–æ–¥–∞–∂: -67.8% (1,250,000 IDR)
   ü§ñ ML –ø—Ä–æ–≥–Ω–æ–∑: 3,876,543 IDR (–æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ: -67.8%)
   
   üîç –î–ï–¢–ï–ö–¢–ò–í–ù–´–ï –§–ê–ö–¢–û–†–´:
      1. üö® –ö–†–ò–¢–ò–ß–ù–û: Grab offline 357% (5—á 57–º –≤—ã–∫–ª—é—á–µ–Ω!)
      2. ‚ö†Ô∏è Gojek Delivery +89% (19.8–º–∏–Ω vs 10.5–º–∏–Ω)
      3. ‚úÖ Gojek ROAS –æ—Ç–ª–∏—á–Ω—ã–π: 25.0
   
   üß† ML –û–ë–™–Ø–°–ù–ï–ù–ò–ï (SHAP):
      ‚Ä¢ üö® Grab offline: -45.2% –≤–ª–∏—è–Ω–∏—è (-1,751,234 IDR)
      ‚Ä¢ ‚è±Ô∏è –í—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏: -12.8% –≤–ª–∏—è–Ω–∏—è (-495,637 IDR)  
      ‚Ä¢ üå§Ô∏è –ü–æ–≥–æ–¥–∞: +3.1% –≤–ª–∏—è–Ω–∏—è (+120,123 IDR)
      ‚Ä¢ üìÖ –î–µ–Ω—å –Ω–µ–¥–µ–ª–∏: -2.4% –≤–ª–∏—è–Ω–∏—è (-93,077 IDR)
      ‚Ä¢ ‚ùì –ù–µ–æ–±—ä—è—Å–Ω–µ–Ω–Ω–æ–µ: 1.6%
   
   üí° ML –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò:
      ‚Ä¢ –°—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è Grab = –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª +1,751,234 IDR
      ‚Ä¢ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏ = –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª +495,637 IDR
      ‚Ä¢ –û–±—â–∏–π –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª —Ä–æ—Å—Ç–∞: +2,246,871 IDR (179.8%)
```

## üõ†Ô∏è –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –¢–†–ï–ë–û–í–ê–ù–ò–Ø

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```bash
pip install scikit-learn>=1.3.0 shap>=0.42.0 numpy>=1.24.0
```

### –§–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è/–∏–∑–º–µ–Ω–µ–Ω–∏—è:
1. **–°–æ–∑–¥–∞—Ç—å:** `src/analyzers/integrated_ml_detective.py` (–Ω–æ–≤—ã–π)
2. **–ò–∑–º–µ–Ω–∏—Ç—å:** `src/analyzers/production_sales_analyzer.py` (–¥–æ–±–∞–≤–∏—Ç—å ML)
3. **–ò–∑–º–µ–Ω–∏—Ç—å:** `src/analyzers/__init__.py` (—ç–∫—Å–ø–æ—Ä—Ç)
4. **–û–±–Ω–æ–≤–∏—Ç—å:** `requirements.txt` (ML –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏)

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
```python
# –¢–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
from src.analyzers import ProductionSalesAnalyzer

analyzer = ProductionSalesAnalyzer()
result = analyzer.analyze_restaurant_performance(
    "Only Eggs", "2025-04-01", "2025-05-31"
)

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –µ—Å—Ç—å ML –æ–±—ä—è—Å–Ω–µ–Ω–∏—è
assert "üß† ML –û–ë–™–Ø–°–ù–ï–ù–ò–ï" in "\n".join(result)
assert "SHAP" in "\n".join(result)
```

## üéØ –ü–†–ò–û–†–ò–¢–ï–¢–´ –†–ï–ê–õ–ò–ó–ê–¶–ò–ò

### üî• –í–´–°–û–ö–ò–ô (—Å–¥–µ–ª–∞—Ç—å —Å–Ω–∞—á–∞–ª–∞):
1. –°–æ–∑–¥–∞—Ç—å `IntegratedMLDetective` –∫–ª–∞—Å—Å
2. –î–æ–±–∞–≤–∏—Ç—å SHAP –æ–±—ä—è—Å–Ω–µ–Ω–∏—è –¥–ª—è –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –¥–Ω–µ–π
3. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ `ProductionSalesAnalyzer`

### üü° –°–†–ï–î–ù–ò–ô (–ø–æ—Ç–æ–º):
4. –î–æ–±–∞–≤–∏—Ç—å ML –ø—Ä–æ–≥–Ω–æ–∑—ã –Ω–∞ –±—É–¥—É—â–µ–µ
5. –£–ª—É—á—à–∏—Ç—å —Ç–æ—á–Ω–æ—Å—Ç—å –º–æ–¥–µ–ª–∏
6. –î–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ –≤–Ω–µ—à–Ω–∏—Ö —Ñ–∞–∫—Ç–æ—Ä–æ–≤

### üü¢ –ù–ò–ó–ö–ò–ô (–≤ –∫–æ–Ω—Ü–µ):
7. –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –¥–Ω–µ–π
8. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
9. A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π

## ‚è±Ô∏è –í–†–ï–ú–Ø –†–ï–ê–õ–ò–ó–ê–¶–ò–ò

- **–≠—Ç–∞–ø 1:** 2-3 —á–∞—Å–∞ (–±–∞–∑–æ–≤–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è)
- **–≠—Ç–∞–ø 2:** 3-4 —á–∞—Å–∞ (SHAP –æ–±—ä—è—Å–Ω–∏–º–æ—Å—Ç—å)  
- **–≠—Ç–∞–ø 3:** 1-2 —á–∞—Å–∞ (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞)

**–û–±—â–µ–µ –≤—Ä–µ–º—è:** 6-9 —á–∞—Å–æ–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

## ‚úÖ –ö–†–ò–¢–ï–†–ò–ò –ì–û–¢–û–í–ù–û–°–¢–ò

1. ‚úÖ ML –æ–±—ä—è—Å–Ω–µ–Ω–∏—è –ø–æ—è–≤–ª—è—é—Ç—Å—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ–±–ª–µ–º–Ω–æ–≥–æ –¥–Ω—è
2. ‚úÖ SHAP –∑–Ω–∞—á–µ–Ω–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è  
3. ‚úÖ –ù–µ—Ç —Ü–∏—Ä–∫—É–ª—è—Ä–Ω–æ–π –ª–æ–≥–∏–∫–∏ –≤ –ø—Ä–∏–∑–Ω–∞–∫–∞—Ö
4. ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –Ω–µ –ª–æ–º–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
5. ‚úÖ –¢–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ